{% extends 'base.html' %}
{% block content %}
<section class="profil-wrapper">
  <div class="profil-lava">
    <!-- Profilov√° fotka a upload -->
    <div class="profil-fotka-wrapper">
      {% if pouzivatel.profil_fotka %}
        <img src="{{ url_for('static', filename='profilovky/' ~ pouzivatel.profil_fotka) }}" alt="Profilov√° fotka" class="profilovka">
        <a href="{{ url_for('uzivatel.odstranit_fotku') }}" class="odstranit-krizik">‚úñ</a>
      {% else %}
        <img src="{{ url_for('static', filename='profilovky/default-profil.jpg') }}" alt="Profilov√° fotka" class="profilovka">
      {% endif %}

      <form id="upload-form-user" action="{{ url_for('uzivatel.upload_fotka') }}" method="post" enctype="multipart/form-data">
        <label for="upload-input-user" class="upravit-fotku" title="Zmeni≈• fotku">‚úèÔ∏è</label>
        <input id="upload-input-user" type="file" name="profil_fotka" accept="image/*" onchange="this.form.submit()" hidden>
      </form>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash-messages">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- Zobrazenie √∫dajov -->
    <div id="udaje-zobraz">
      <h2>{{ pouzivatel.prezyvka }} 
        <button id="editButton" class="edit-icon" title="Upravi≈• profil">‚úèÔ∏è</button>
      </h2>
      <p><strong>Meno:</strong> {{ pouzivatel.meno }} {{ pouzivatel.priezvisko }}</p>
      <p><strong>Email:</strong> {{ pouzivatel.email }}</p>
      <p><strong>Mesto / Obec:</strong> {{ pouzivatel.obec }}</p>
      <p><strong>Hudobn√Ω n√°stroj:</strong> {{ pouzivatel.instrument }}</p>
      <p><strong>Doplnkov√Ω n√°stroj:</strong> {{ pouzivatel.doplnkovy_nastroj }}</p>

      <div class="profil-omne">
        <h4>O mne:</h4>
        <p>{{ pouzivatel.bio }}</p>
      </div>
    </div>

    <!-- EDITAƒåN√ù FORMUL√ÅR -->
    <form id="editForm" method="POST" action="{{ url_for('uzivatel.profil') }}" style="display: none;" class="form-profil">
      <div class="form-row">
        <label>Prez√Ωvka:</label>
        <input type="text" name="prezyvka" value="{{ pouzivatel.prezyvka }}" required>
      </div>

      <div class="form-row">
        <label>Meno:</label>
        <input type="text" name="meno" value="{{ pouzivatel.meno }}">
      </div>

      <div class="form-row">
        <label>Priezvisko:</label>
        <input type="text" name="priezvisko" value="{{ pouzivatel.priezvisko }}">
      </div>

      <div class="form-row">
        <label>Email:</label>
        <input type="email" name="email" value="{{ pouzivatel.email }}" required>
      </div>

      <div class="form-row">
        <label>Mesto / Obec:</label>
        <input type="text" name="obec" value="{{ pouzivatel.obec }}">
      </div>

      <div class="form-row">
        <label>Hudobn√Ω n√°stroj:</label>
        <input type="text" name="instrument" value="{{ pouzivatel.instrument }}">
      </div>

      <div class="form-row">
        <label>Doplnkov√Ω n√°stroj:</label>
        <input type="text" name="doplnkovy_nastroj" value="{{ pouzivatel.doplnkovy_nastroj }}">
      </div>

      <div class="form-row">
        <label for="bio">O mne:</label>
        <textarea id="bio" name="bio">{{ pouzivatel.bio or '' }}</textarea>
      </div>

      <div class="form-row">
        <button type="submit">üíæ Ulo≈æi≈• zmeny</button>
        <button type="button" id="cancelEdit">Zru≈°i≈•</button>
      </div>
    </form>
  </div>

  <div class="profil-prava">

    <!-- üßë‚Äçüé§ Skupina -->
    <div class="profil-skupina">
      <h3>Skupina</h3>
      <p><strong>N√°zov:</strong> {{ skupina.nazov }}</p>
      <p><strong>ƒålenovia:</strong></p>
      <ul>
        {% for clen in skupina.clenovia %}
          <li>{{ clen.meno }} ‚Äì {{ clen.instrument }}</li>
        {% endfor %}
      </ul>
    </div>

    <!-- üñºÔ∏è Gal√©ria -->
    <section class="profil-sekcia">
      <div class="nadpis-s-perom">
        <h2>Moja gal√©ria</h2>

        {% if pouzivatel.galeria|length < 10 %}
        <form method="POST" action="{{ url_for('profil.nahraj_fotku') }}" enctype="multipart/form-data" id="upload-form">
          <label for="upload-foto" class="edit-icon" title="Nahra≈• nov√∫ fotku">‚úèÔ∏è</label>
          <input type="file" name="foto" id="upload-foto" accept="image/*" onchange="this.form.submit()" hidden>
        </form>
        {% endif %}
      </div>

      <div class="galeria-wrapper">
        {% for foto in pouzivatel.galeria %}
          <div class="foto-blok">
            <img src="{{ url_for('static', filename='galeria_pouzivatel/' ~ foto.nazov_suboru) }}" alt="Foto" class="galeria-foto">
            <form method="POST" action="{{ url_for('profil.zmaz_fotku', id=foto.id) }}" onsubmit="return confirm('Naozaj chce≈° zmaza≈• t√∫to fotku?');">
              <button type="submit" class="zmaz-btn">‚úñ</button>
            </form>
          </div>
        {% endfor %}
      </div>
    </section>

    <!-- ‚ñ∂Ô∏è YouTube -->
    
    <div class="video-box">
        <h3>üé• Vide√°</h3>

        <div class="profil-videoform-riadok">
          <form action="{{ url_for('profil.pridaj_video') }}" method="POST" class="profil-videoform">
            <input type="text" name="youtube_url" placeholder="https://www.youtube.com/watch?v=..." required>
            <input type="text" name="popis" placeholder="Kr√°tky popis (voliteƒæn√©)">
            <button type="submit">‚ûï Prida≈• video</button>
          </form>

          <p class="profil-pocet-videi">Poƒçet vide√≠: {{ youtube_videa | length }}</p>
        </div>

        <div class="profil-video-grid">
          {% for video in youtube_videa %}
            <div class="profil-youtube-video">
              <iframe src="https://www.youtube.com/embed/{{ video.youtube_url | youtube_id }}"
                      frameborder="0"
                      allowfullscreen></iframe>
              {% if video.popis %}
                <p>{{ video.popis }}</p>
              {% endif %}
              <form action="{{ url_for('profil.zmaz_video', id=video.id) }}" method="POST">
                <button type="submit" class="zmaz-video" onclick="return confirm('Naozaj chce≈° zmaza≈• video?')">‚úñ</button>
              </form>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
</section>

{% endblock %}