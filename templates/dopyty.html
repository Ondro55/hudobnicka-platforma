{% extends 'base.html' %}
{% block title %}Dopyty | Muzikuj{% endblock %}

{% block content %}
<section class="bazar-wrapper dopyty-wrapper" style="padding: 2rem; max-width: 1100px; margin: 0 auto;">

  <!-- HLAVIƒåKA -->
  <header class="bazar-header" style="margin-bottom: 1.5rem;">
    <h1 style="margin: 0;">üéØ Dopyty</h1>
    <p style="margin: .25rem 0 0 0;">Zoznam po≈æiadaviek na hudbu vytvoren√Ωch verejn√Ωm formul√°rom.</p>
  </header>

  <!-- FILTRE (jednoduch√Ω z√°klad; ak e≈°te nechce≈° filtre, nechaj action "", odo≈°le sa na t√∫ ist√∫ URL) -->
  <section class="bazar-filter filter-panel" style="margin-bottom: 1.5rem; border: 1px solid var(--hover); border-radius: 12px; padding: 1rem;">
    <form method="GET" action="{{ url_for('dopyty.zobraz_dopyty') }}"
          style="display:grid;grid-template-columns:1fr 2fr 1fr auto;gap:.75rem;align-items:end;">

      <!-- 1) Typ akcie -->
      <div>
        <label for="typ_akcie" class="label">Typ akcie</label>
        <select id="typ_akcie" name="typ_akcie" class="select" style="width:100%;">
          <option value="">V≈°etko</option>
          {% for val, label in [('svadba','Svadba'),('oslava','Oslava'),('firemna','Firemn√° akcia'),('ine','In√©')] %}
            <option value="{{ val }}" {% if request.args.get('typ_akcie')==val %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- 2) Miesto (presn√© z DB) -->
      <div>
        <label for="mesto_id" class="label">Miesto</label>
        <select id="mesto_id" name="mesto_id" class="select" style="width:100%;">
          <option value="">V≈°etky</option>
          {% for m in mesta %}
            <option value="{{ m.id }}" {% if request.args.get('mesto_id', type=int)==m.id %}selected{% endif %}>
              {{ m.nazov }}{% if m.okres %}, {{ m.okres }}{% endif %}{% if m.kraj %}, {{ m.kraj }}{% endif %}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- 3) D√°tum -->
      <div>
        <label for="datum" class="label">D√°tum</label>
        <input id="datum" name="datum" type="date"
              value="{{ request.args.get('datum','') }}" class="input" style="width:100%;">
      </div>

      <div style="display:flex; gap:.5rem;">
        <button type="submit" class="btn">Filtrova≈•</button>
        <a class="btn" href="{{ url_for('dopyty.zobraz_dopyty') }}">Zru≈°i≈•</a>
      </div>
    </form>
  </section>


  <!-- ZOZNAM DOPYTOV (≈°t√Ωl ako v baz√°ri) -->
  <section class="bazar-list dopyty-list" style="display: grid; grid-template-columns: 1fr; gap: 1rem;">
    {% if dopyty and dopyty|length %}
      {% for d in dopyty %}
        <article class="inzerat-card dopyt-card" style="border: 1px solid var(--hover); border-radius: 12px; padding: 1rem;">
          <div class="card-top" style="display:flex; justify-content:space-between; gap:1rem; flex-wrap: wrap;">
            <h3 style="margin:0;">
              {{ d.typ_akcie|title if d.typ_akcie else 'Dopyt' }}
            </h3>
            <div class="card-date" style="opacity:.8;">
              {% if d.datum %}üìÖ {{ d.datum.strftime('%d.%m.%Y') }}{% endif %}
              {% if d.cas_od or d.cas_do %}
                &nbsp;‚Ä¢&nbsp; ‚è∞ {{ d.cas_od.strftime('%H:%M') if d.cas_od else '‚Äî' }} ‚Äì {{ d.cas_do.strftime('%H:%M') if d.cas_do else '‚Äî' }}
              {% endif %}
            </div>
          </div>

          <div class="card-meta" style="margin-top:.5rem; display:flex; gap:1rem; flex-wrap:wrap; opacity:.9;">

            {# 1) Miesto ‚Äì najprv z FK, inak fallback na text #}
            {% if d.mesto %}
              <span>üìç {{ d.mesto.nazov }}{% if d.mesto.okres %}, {{ d.mesto.okres }}{% endif %}{% if d.mesto.kraj %}, {{ d.mesto.kraj }}{% endif %}</span>
            {% elif d.miesto %}
              <span>üìç {{ d.miesto }}</span>
            {% endif %}

            {# 2) Rozpoƒçet ‚Äì zobraz aj 0, ak by bol #}
            {% if d.rozpocet is not none %}
              <span>üí∂ {{ '%.0f'|format(d.rozpocet) }} ‚Ç¨</span>
            {% endif %}

            {# 3) Meno zad√°vateƒæa (ak chce≈° ukazova≈•) #}
            {% if d.meno %}
              <span>üë§ {{ d.meno }}</span>
            {% endif %}
          </div>

          {% if d.popis %}
            <p class="card-desc" style="margin-top:.75rem;">
              {{ d.popis | truncate(220, True, '‚Ä¶') }}
            </p>
          {% endif %}

          <div class="card-actions" style="display:flex; gap:.5rem; margin-top:.75rem; flex-wrap:wrap;">
            <!-- Ak bude≈° ma≈• detail, prid√°me sem link -->
            <button
              class="btn"
              data-open="sprava-modal"
              data-dopyt-id="{{ d.id }}"
              data-dopyt-typ="{{ d.typ_akcie }}"
              data-dopyt-datum="{{ d.datum.strftime('%d.%m.%Y') if d.datum }}"
              data-dopyt-miesto="{{ d.miesto }}"
              data-dopyt-meno="{{ d.meno }}"
              data-dopyt-email="{{ d.email }}"
            >
              Reagova≈•
            </button>
          </div>
        </article>
      {% endfor %}
    {% else %}
      <div class="empty-state" style="text-align:center; padding: 2rem; border:1px dashed var(--hover); border-radius: 12px;">
        <p>Zatiaƒæ ≈æiadne dopyty podƒæa zvolen√Ωch filtrov.</p>
        <a class="btn" href="{{ url_for('dopyty.zobraz_dopyty') }}">Zobrazi≈• v≈°etko</a>
      </div>
    {% endif %}
  </section>

  <!-- PAGIN√ÅCIA (ak ju nesk√¥r prid√°≈°) -->
  {# 
  {% if pagination %}
    <nav class="bazar-pagination" aria-label="Str√°nkovanie" style="margin-top: 1rem; display:flex; gap:.5rem; justify-content:center;">
      {% if pagination.prev_url %}<a class="btn" href="{{ pagination.prev_url }}">&larr; Predo≈°l√°</a>{% endif %}
      <span style="padding:.5rem .75rem; opacity:.8;">Strana {{ pagination.page }} / {{ pagination.pages }}</span>
      {% if pagination.next_url %}<a class="btn" href="{{ pagination.next_url }}">ƒéal≈°ia &rarr;</a>{% endif %}
    </nav>
  {% endif %}
  #}

</section>
{% endblock %}
