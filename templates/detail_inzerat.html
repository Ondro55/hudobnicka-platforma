{% extends 'base.html' %}
{% block title %}Detail inzerátu{% endblock %}

{% block content %}
<section class="detail-inzerat">
  <a href="{{ request.referrer or url_for('inzerat.moj_bazar') }}" class="link-spat">← Späť</a>

  <header class="detail-head">
    <h1>{{ inz.typ }} – {{ inz.kategoria }}</h1>
    <div class="meta">
      <span>📍 {{ inz.mesto_objekt.nazov if inz.mesto_objekt else '—' }}</span>
      <span>💶 {{ '%.2f'|format(inz.cena or 0) }} €</span>
      <span>🚚 {{ inz.doprava or '—' }}</span>
      <span>🕒 {{ inz.datum.strftime('%d.%m.%Y') }}</span>
    </div>
  </header>

  {% if inz.popis %}
    <article class="popis">
      <h3>Popis</h3>
      <p>{{ inz.popis }}</p>
    </article>
  {% endif %}

  <section class="galeria">
    <h3>Fotky</h3>
    <div class="thumbs">
      {% for foto in inz.fotky %}
        <img
          src="{{ url_for('static', filename='galeria_inzerat/' ~ foto.nazov_suboru) }}"
          alt="Foto {{ loop.index }}"
          class="thumb"
          data-index="{{ loop.index0 }}"
        >
      {% else %}
        <p>Žiadne fotky.</p>
      {% endfor %}
    </div>
  </section>
</section>

<!-- Lightbox -->
<div id="lightbox" class="lb hidden" aria-hidden="true">
  <button class="lb-close" aria-label="Zavrieť">✖</button>
  <button class="lb-prev" aria-label="Predošlá">‹</button>
  <img id="lb-img" alt="Náhľad">
  <button class="lb-next" aria-label="Ďalšia">›</button>
</div>

<style>
.detail-inzerat { padding: 1.5rem; }
.detail-head h1 { margin: 0 0 .5rem; }
.meta { display:flex; flex-wrap:wrap; gap:.75rem; color:#555; }
.popis { margin: 1rem 0 1.5rem; }
.galeria .thumbs { display:grid; grid-template-columns: repeat(auto-fill, minmax(140px,1fr)); gap:.75rem; }
.thumb { width:100%; height:140px; object-fit:cover; border-radius:.5rem; cursor:pointer; }
.lb { position:fixed; inset:0; background:rgba(0,0,0,.8); display:flex; align-items:center; justify-content:center; z-index:1000; }
.lb.hidden { display:none; }
#lb-img { max-width:90vw; max-height:85vh; border-radius:.5rem; }
.lb-close, .lb-prev, .lb-next {
  position:absolute; background:rgba(255,255,255,.85); border:0; border-radius:.5rem; padding:.4rem .6rem; cursor:pointer; font-size:1.2rem;
}
.lb-close { top:1rem; right:1rem; }
.lb-prev { left:1rem; }
.lb-next { right:1rem; }
</style>

<script>
(function(){
  const thumbs = Array.from(document.querySelectorAll('.thumb'));
  if (!thumbs.length) return;

  const lb = document.getElementById('lightbox');
  const lbImg = document.getElementById('lb-img');
  const btnClose = lb.querySelector('.lb-close');
  const btnPrev = lb.querySelector('.lb-prev');
  const btnNext = lb.querySelector('.lb-next');

  const sources = thumbs.map(t => t.src);
  let i = 0;

  function openAt(idx){
    i = idx;
    lbImg.src = sources[i];
    lb.classList.remove('hidden');
    lb.setAttribute('aria-hidden','false');
  }
  function close(){
    lb.classList.add('hidden');
    lb.setAttribute('aria-hidden','true');
    lbImg.src = '';
  }
  function prev(){ i = (i - 1 + sources.length) % sources.length; lbImg.src = sources[i]; }
  function next(){ i = (i + 1) % sources.length; lbImg.src = sources[i]; }

  thumbs.forEach(t => t.addEventListener('click', e => openAt(parseInt(e.target.dataset.index, 10))));
  btnClose.addEventListener('click', close);
  btnPrev.addEventListener('click', prev);
  btnNext.addEventListener('click', next);
  lb.addEventListener('click', (e) => { if (e.target === lb) close(); });
  document.addEventListener('keydown', (e) => {
    if (lb.classList.contains('hidden')) return;
    if (e.key === 'Escape') close();
    if (e.key === 'ArrowLeft') prev();
    if (e.key === 'ArrowRight') next();
  });
})();
</script>
{% endblock %}
