{% extends "base.html" %}
{% block title %}Moje reklamy | Muzikuj{% endblock %}
{% block content %}
<section class="komunita-wrapper" style="padding:2rem;">
  <h2 style="margin:0 0 1rem 0;">üì¢ Moje reklamy</h2>

  <article class="card" style="padding:1rem; margin-bottom:1rem;">
    <h3 style="margin-top:0;">Vytvori≈• reklamu</h3>
    <form action="{{ url_for('reklama.vytvor') }}" method="POST" enctype="multipart/form-data" class="grid" style="gap:.75rem;">
      <label>N√°zov<input type="text" name="nazov" required></label>
      <label>Text<textarea name="text" rows="3" placeholder="Kr√°tky text reklamy"></textarea></label>
      <label>Cieƒæov√° URL<input type="url" name="url" placeholder="https://..."></label>
      <div style="display:flex; gap:.75rem; flex-wrap:wrap;">
        <label>Zaƒçiatok<input type="datetime-local" name="start"></label>
        <label>Koniec<input type="datetime-local" name="end"></label>
        <label class="chip"><input type="checkbox" name="is_top" value="1"> Topova≈•</label>
      </div>
      <label>Obr√°zok<input type="file" name="foto" accept="image/*"></label>
      <button class="btn primary" type="submit">‚ûï Vytvori≈•</button>
    </form>
  </article>

  {% if reklamy and reklamy|length %}
    <div class="list-rows">
      {% for ad in reklamy %}
      <article class="list-row" style="display:grid; grid-template-columns:80px 1fr auto; gap:1rem; align-items:center;">
        <div><img src="{{ ad.foto_url }}" alt="Reklama" style="width:72px;height:72px;object-fit:cover;border-radius:.5rem;"></div>
        <div class="text-clip">
          <div style="font-weight:600;">{{ ad.nazov }} {% if ad.is_top %}<span class="role-badge">TOP</span>{% endif %}</div>
          <div class="meta" style="color:#666;">
            {{ ad.start_dt|localtime('%d.%m.%Y %H:%M') }}
            ‚Äì {{ ad.end_dt|localtime('%d.%m.%Y %H:%M') if ad.end_dt else 'bez konca (7 dn√≠ default)'}}
          </div>
          {% if ad.text %}<div style="color:#444; margin-top:.25rem; white-space:pre-wrap;">{{ ad.text }}</div>{% endif %}
          {% if ad.url %}<div><a href="{{ ad.url }}" target="_blank" rel="noopener">Odkaz</a></div>{% endif %}
        </div>
        <div class="row-actions" style="display:flex; gap:.5rem;">
          <a class="btn sm" href="{{ url_for('reklama.edit', id=ad.id) }}">‚úèÔ∏è Upravi≈•</a>
          <form action="{{ url_for('reklama.upload_foto', id=ad.id) }}" method="POST" enctype="multipart/form-data">
            <label class="btn sm">Zmeni≈• obr√°zok<input type="file" name="foto" hidden accept="image/*" onchange="this.form.submit()"></label>
          </form>
          {% if ad.foto_nazov %}
          <form action="{{ url_for('reklama.zmaz_foto', id=ad.id) }}" method="POST" onsubmit="return confirm('Odstr√°ni≈• obr√°zok?');">
            <button class="btn sm">Zmaza≈• obr√°zok</button>
          </form>
          {% endif %}
          <form action="{{ url_for('reklama.zmaz', id=ad.id) }}" method="POST" onsubmit="return confirm('Zmaza≈• reklamu?');">
            <button class="btn">üóëÔ∏è Zmaza≈•</button>
          </form>
        </div>
      </article>
      {% endfor %}
    </div>
  {% else %}
    <p style="color:#666;">Zatiaƒæ nem√°≈° ≈æiadne reklamy.</p>
  {% endif %}
</section>
{% endblock %}
