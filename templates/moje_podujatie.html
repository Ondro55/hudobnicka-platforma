{% extends "base.html" %}
{% block title %}Moje podujatia | Muzikuj{% endblock %}

{% block content %}
<section class="komunita-wrapper" style="padding:2rem;">
  <h2 style="margin:0 0 1rem 0;">üì£ Moje podujatia</h2>

  <!-- Vytvori≈• nov√© -->
  <article class="card" style="padding:1rem; margin-bottom:1rem;">
    <h3 style="margin-top:0;">Vytvori≈• podujatie</h3>
    <form action="{{ url_for('podujatie.vytvor') }}" method="POST" enctype="multipart/form-data" class="grid" style="gap:.75rem;">
      <label>N√°zov
        <input type="text" name="nazov" required>
      </label>

      <label>Organiz√°tor
        <input type="text" name="organizator" placeholder="(predvypln√≠≈° n√°zvom organiz√°cie)">
      </label>

      <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
        <label>D√°tum
          <input type="date" name="datum" required>
        </label>
        <label>ƒåas
          <input type="time" name="cas" required>
        </label>
        <label>Miesto
          <input type="text" name="miesto" placeholder="Mesto / priestor">
        </label>
      </div>

      <label>Popis
        <textarea name="popis" rows="4" placeholder="Kr√°tky popis podujatia"></textarea>
      </label>

      <div style="display:flex;align-items:center;gap:.75rem;flex-wrap:wrap;">
        <label>Bulletin fotka (1 ks)
          <input type="file" name="foto" accept="image/*">
        </label>
        <small style="color:#666;">Povolen√©: PNG, JPG, JPEG, WEBP, GIF</small>
      </div>

      <div>
        <button class="btn primary" type="submit">‚ûï Vytvori≈•</button>
      </div>
    </form>
  </article>

  <!-- AKT√çVNE -->
<h3 style="margin:1rem 0 .5rem 0;">Akt√≠vne</h3>
{% if aktivne and aktivne|length %}
  <div class="list-rows">
    {% for e in aktivne %}
    <article class="list-row" style="display:grid; grid-template-columns:80px 1fr auto; gap:1rem; align-items:center;">
      <div>
        <img src="{{ e.foto_url }}" alt="Foto podujatia"
             style="width:72px;height:72px;object-fit:cover;border-radius:.5rem;display:block;">
      </div>
      <div class="text-clip">
        <div style="font-weight:600;">{{ e.nazov }}</div>
        <div class="meta" style="color:#666;">
          {{ e.organizator or '‚Äî' }} ‚Ä¢ {{ e.miesto or '‚Äî' }} ‚Ä¢ {{ e.start_dt | localtime('%d.%m.%Y %H:%M') }}
        </div>
        {% if e.popis %}<div style="color:#444;margin-top:.25rem;white-space:pre-wrap;">{{ e.popis }}</div>{% endif %}
      </div>
      <div class="row-actions" style="display:flex; gap:.5rem; align-items:center;">
        <a class="btn sm" href="{{ url_for('podujatie.edit', id=e.id) }}">‚úèÔ∏è Upravi≈•</a>

        <form action="{{ url_for('podujatie.upload_foto', id=e.id) }}" method="POST" enctype="multipart/form-data">
          <label class="btn sm">
            Zmeni≈• fotku
            <input type="file" name="foto" accept="image/*" hidden onchange="this.form.submit()">
          </label>
        </form>

        {% if e.foto_nazov %}
        <form action="{{ url_for('podujatie.zmaz_foto', id=e.id) }}" method="POST"
              onsubmit="return confirm('Odstr√°ni≈• fotku tohto podujatia?');">
          <button class="btn sm" type="submit">Zmaza≈• fotku</button>
        </form>
        {% endif %}

        <form action="{{ url_for('podujatie.zmaz', id=e.id) }}" method="POST"
              onsubmit="return confirm('Zmaza≈• cel√© podujatie?');">
          <button class="btn" type="submit">üóëÔ∏è Zmaza≈•</button>
        </form>
      </div>
    </article>
    {% endfor %}
  </div>
{% else %}
  <p style="color:#666;">≈Ωiadne akt√≠vne podujatia.</p>
{% endif %}

<!-- ARCH√çV -->
<h3 style="margin:1.25rem 0 .5rem 0;">Arch√≠v</h3>
{% if archiv and archiv|length %}
  <div class="list-rows">
    {% for e in archiv %}
    <article class="list-row" style="display:grid; grid-template-columns:80px 1fr auto; gap:1rem; align-items:center; opacity:.9;">
      <div>
        <img src="{{ e.foto_url }}" alt="Foto podujatia"
             style="width:72px;height:72px;object-fit:cover;border-radius:.5rem;display:block;">
      </div>
      <div class="text-clip">
        <div style="font-weight:600;">{{ e.nazov }}</div>
        <div class="meta" style="color:#666;">
          {{ e.organizator or '‚Äî' }} ‚Ä¢ {{ e.miesto or '‚Äî' }} ‚Ä¢ {{ e.start_dt | localtime('%d.%m.%Y %H:%M') }}
        </div>
        {% if e.popis %}<div style="color:#444;margin-top:.25rem;white-space:pre-wrap;">{{ e.popis }}</div>{% endif %}
      </div>
      <div class="row-actions" style="display:flex; gap:.5rem; align-items:center;">
        <a class="btn sm" href="{{ url_for('podujatie.edit', id=e.id) }}">‚úèÔ∏è Upravi≈•</a>
        <form action="{{ url_for('podujatie.zmaz', id=e.id) }}" method="POST"
              onsubmit="return confirm('Zmaza≈• cel√© podujatie?');">
          <button class="btn" type="submit">üóëÔ∏è Zmaza≈•</button>
        </form>
      </div>
    </article>
    {% endfor %}
  </div>
{% else %}
  <p style="color:#666;">Arch√≠v je pr√°zdny.</p>
{% endif %}
</section>
{% endblock %}
