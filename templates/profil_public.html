{% extends "base.html" %}
{% block title %}Profil | Muzikuj{% endblock %}

{% block content %}
<section class="komunita-wrapper" style="padding:2rem;">
  <article class="card" style="padding:1rem;">
    <!-- HLAVIƒåKA PROFILU -->
    <header style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;">
      <a href="{{ url_for('uzivatel.verejny_profil', user_id=pouzivatel.id) }}">
        <img src="{{ pouzivatel.profil_fotka_url }}" alt="Profilov√° fotka"
             style="width:72px;height:72px;border-radius:50%;object-fit:cover;">
      </a>
      <div>
        <h2 style="margin:.2rem 0;">{{ pouzivatel.prezyvka }}</h2>
        <div class="meta" style="color:#666;">
          {% if pouzivatel.obec %}üìç {{ pouzivatel.obec }}{% endif %}
        </div>
      </div>
    </header>

    <!-- INFO O SKUPINE + ƒåLENOVIA -->
    {% if skupina %}
      <hr style="margin:1rem 0;">
      <section>
        <div style="display:flex; align-items:center; gap:.75rem; flex-wrap:wrap;">
          <div style="display:flex; align-items:center; gap:.5rem;">
            {% set pf = skupina.profil_fotka_skupina %}
            {% set foto_url = (url_for('static', filename='profilovky_skupina/' ~ pf) if pf else url_for('static', filename='profilovky/default.png')) %}
            <a href="{{ url_for('skupina.skupina_detail', id=skupina.id) }}">
              <img src="{{ foto_url }}" alt="Skupina"
                   style="width:42px;height:42px;object-fit:cover;border-radius:50%;">
            </a>
            <h3 style="margin:0;">
              <a class="link-plain" href="{{ url_for('skupina.skupina_detail', id=skupina.id) }}">
                {{ skupina.nazov }}
              </a>
            </h3>
          </div>
          {% if skupina.mesto %}
            <span class="meta" style="color:#666;">üìç {{ skupina.mesto }}</span>
          {% endif %}
        </div>

        {% if skupina.clenovia and skupina.clenovia|length %}
          <div style="margin-top:.5rem;">
            <div class="meta" style="color:#666; margin-bottom:.25rem;">ƒålenovia:</div>
            <div style="display:flex; flex-wrap:wrap; gap:.5rem .75rem;">
              {% for cl in skupina.clenovia %}
                <a class="link-plain"
                   href="{{ url_for('uzivatel.verejny_profil', user_id=cl.id) }}"
                   style="text-decoration:none;">
                  {{ cl.prezyvka }}
                </a>
                {# medzery/oddeƒæovanie rie≈°ime pomocou gap; ≈æiadne podƒçiarknutie #}
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </section>
    {% endif %}

    <!-- BIO -->
    {% if pouzivatel.bio %}
      <hr style="margin:1rem 0;">
      <section>
        <h3 style="margin:0 0 .5rem 0;">O mne</h3>
        <div style="white-space:pre-wrap;">{{ pouzivatel.bio }}</div>
      </section>
    {% endif %}

    <!-- GAL√âRIA SKUPINY (ak existuje) -->
    {% if galeria and galeria|length %}
      <hr style="margin:1rem 0;">
      <section>
        <h3 style="margin:0 0 .5rem 0;">Gal√©ria</h3>
        <div class="gallery-grid">
          {% for g in galeria %}
            {% set img_url = url_for('static', filename='galeria_skupina/' ~ g.nazov_suboru) %}
            <a href="{{ img_url }}" class="gallery-item" data-full="{{ img_url }}">
              <img src="{{ img_url }}" alt="Foto" loading="lazy">
            </a>
          {% endfor %}
        </div>
      </section>
    {% endif %}

    <!-- VIDE√Å (ak chce≈° zobrazi≈• YouTube linky z user.videa) -->
    {% if youtube_videa and youtube_videa|length %}
      <hr style="margin:1rem 0;">
      <section>
        <h3 style="margin:0 0 .5rem 0;">Videa</h3>
        <div class="video-grid">
          {% for v in youtube_videa %}
            {# oƒçak√°vame cel√© YouTube URL v v.youtube_url #}
            <div class="video-embed">
              <iframe src="https://www.youtube.com/embed/{{ v.youtube_url.split('v=')[-1].split('&')[0] }}"
                      title="YouTube video"
                      frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                      allowfullscreen loading="lazy"></iframe>
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  </article>
</section>

<!-- LIGHTBOX OVERLAY -->
<div id="lightbox" class="lightbox" aria-hidden="true">
  <button class="lb-close" aria-label="Zavrie≈•" onclick="LB.close()">√ó</button>
  <button class="lb-prev" aria-label="Predch√°dzaj√∫ca" onclick="LB.prev()">‚Äπ</button>
  <img id="lightbox-img" alt="">
  <button class="lb-next" aria-label="ƒéal≈°ia" onclick="LB.next()">‚Ä∫</button>
</div>

<style>
  /* link-plain u≈æ asi m√°≈° glob√°lne; pre istotu */
  .link-plain{ color:inherit; text-decoration:none; }
  .link-plain:hover{ text-decoration:underline; }

  .gallery-grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(140px,1fr));
    gap:.5rem;
  }
  .gallery-item{ display:block; border-radius:10px; overflow:hidden; }
  .gallery-item img{
    width:100%; height:120px; object-fit:cover; display:block;
    transition: transform .2s ease;
  }
  .gallery-item:hover img{ transform:scale(1.03); }

  /* jednoduch√Ω lightbox */
  .lightbox{
    position:fixed; inset:0; background:rgba(0,0,0,.85);
    display:none; align-items:center; justify-content:center;
    z-index:1000; padding:2rem;
  }
  .lightbox.open{ display:flex; }
  .lightbox img{
    max-width:min(90vw,1400px); max-height:85vh; object-fit:contain; border-radius:8px;
  }
  .lb-close, .lb-prev, .lb-next{
    position:absolute; background:rgba(255,255,255,.1); color:#fff; border:none;
    width:44px; height:44px; border-radius:999px; font-size:28px; line-height:44px;
    display:flex; align-items:center; justify-content:center; cursor:pointer;
    transition: background .15s ease;
  }
  .lb-close{ top:18px; right:18px; }
  .lb-prev{ left:18px; }
  .lb-next{ right:18px; }
  .lb-close:hover, .lb-prev:hover, .lb-next:hover{ background:rgba(255,255,255,.2); }

  .video-grid{
    display:grid; gap:1rem;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  }
  .video-embed{ position:relative; padding-bottom:56.25%; height:0; overflow:hidden; border-radius:12px; background:#000; }
  .video-embed iframe{ position:absolute; inset:0; width:100%; height:100%; }
</style>

<script>
  // Lightbox jednoduch√Ω JS
  const LB = (function(){
    let items = [];
    let index = 0;
    const el = document.getElementById('lightbox');
    const img = document.getElementById('lightbox-img');

    function open(i){
      items = Array.from(document.querySelectorAll('.gallery-item'));
      index = i;
      const src = items[index].dataset.full;
      img.src = src;
      el.classList.add('open');
      el.setAttribute('aria-hidden', 'false');
      document.addEventListener('keydown', onKey);
    }
    function close(){
      el.classList.remove('open');
      el.setAttribute('aria-hidden', 'true');
      img.src = '';
      document.removeEventListener('keydown', onKey);
    }
    function prev(){ if(!items.length) return; index = (index - 1 + items.length) % items.length; img.src = items[index].dataset.full; }
    function next(){ if(!items.length) return; index = (index + 1) % items.length; img.src = items[index].dataset.full; }
    function onKey(e){
      if(e.key === 'Escape') close();
      if(e.key === 'ArrowLeft') prev();
      if(e.key === 'ArrowRight') next();
    }
    // navia≈æ kliky
    document.addEventListener('click', function(e){
      const a = e.target.closest('.gallery-item');
      if(a){
        e.preventDefault();
        const all = Array.from(document.querySelectorAll('.gallery-item'));
        open(all.indexOf(a));
      }
    });

    return { open, close, prev, next };
  })();
  window.LB = LB;
</script>
{% endblock %}
