{# templates/komunita/_rychly_dopyt.html ‚Äî inline ‚ÄûR√Ωchly dopyt‚Äú bez mod√°lov #}
<div class="rd-layout">
  <!-- ƒΩAVO: mini-form + filter -->
  <section class="rd-left">
    <article class="card" style="padding:1rem;margin-bottom:.75rem;">
      <h3 style="margin:0 0 .5rem 0;">Prida≈• r√Ωchly dopyt</h3>
      {% if current_user.is_authenticated %}
        <form method="post" action="{{ url_for('komunita.rychly_dopyt_create') }}" style="display:grid;gap:.6rem;">
          {{ csrf_token() if csrf_token is defined }}

          <textarea class="input" name="text" rows="3" maxlength="500"
                    placeholder="Struƒçne: ƒço hƒæad√°≈° / pon√∫ka≈°, kde, kedy‚Ä¶"
                    required></textarea>

          <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
            <select class="select" name="mesto_id" style="min-width:180px;">
              <option value="">‚Äî Mesto (voliteƒæn√©) ‚Äî</option>
              {% for m in (mesta_all or []) %}
                <option value="{{ m.id }}">{{ m.nazov }}</option>
              {% endfor %}
            </select>

            <label class="meta" style="display:inline-flex;align-items:center;gap:.35rem;">
              Platnos≈•:
              <input class="input" type="number" name="platnost_dni" min="1" max="60" value="14" style="width:80px;">
              dn√≠
            </label>

            <div style="margin-left:auto;">
              <button class="btn primary" type="submit">Prida≈•</button>
            </div>
          </div>
          <div class="meta" style="color:#666;">Anti-spam: max 1 dopyt / 2 min.</div>
        </form>
      {% else %}
        <div style="display:flex;justify-content:space-between;align-items:center;gap:.5rem;flex-wrap:wrap;">
          <div class="meta" style="color:#666;">Na pridanie dopytu sa prihl√°s.</div>
          <a class="btn primary" href="#" data-modal-open="#modal-login">Prihl√°si≈• sa</a>
        </div>
      {% endif %}
    </article>

    <div class="filterbar">
      <form class="filter-row" method="get" action="{{ url_for('komunita.hub') }}">
        <input type="hidden" name="tab" value="rychly-dopyt">

        <input class="input" type="search" name="q"
               value="{{ request.args.get('q','') }}" placeholder="Hƒæada≈• v dopytoch‚Ä¶">

        <select class="select" name="mesto" title="Mesto">
          <option value="">V≈°etky mest√°</option>
          {% for m in (mesta_all or []) %}
            <option value="{{ m.id }}" {{ 'selected' if request.args.get('mesto', type=int)==m.id else '' }}>
              {{ m.nazov }}
            </option>
          {% endfor %}
        </select>

        <button class="btn sm" type="submit">Filtrova≈•</button>
      </form>

      <div class="filter-row mine-row">
        <a href="{{ url_for('komunita.hub', tab='rychly-dopyt', view='mine') }}"
           class="chip-btn {{ 'active' if request.args.get('view')=='mine' else '' }}">Moje dopyty</a>
      </div>
    </div>
  </section>

  <!-- PRAVO: zoznam kariet -->
  <aside class="rd-right">
    {% if (rychle_dopyty or []) %}
      <div class="rd-list">
        {% for d in rychle_dopyty %}
          <article class="card rd-card">
            <header class="rd-head">
              <div class="meta">
                üßë {{ (d.autor.prezyvka or d.autor.email) if d.autor else 'Pou≈æ√≠vateƒæ' }}
                ‚Ä¢ ‚è±Ô∏è {{ d.created_at|localtime if d.created_at else '' }}
                {% if d.mesto and d.mesto.nazov %} ‚Ä¢ üìç {{ d.mesto.nazov }}{% endif %}
                {% if not d.aktivny %} ‚Ä¢ ‚ùå uzavret√©{% endif %}
              </div>
              {% if current_user.is_authenticated and (current_user.id == d.autor_id or current_user.is_admin or current_user.is_moderator) and d.aktivny %}
                <form method="post" action="{{ url_for('komunita.rychly_dopyt_close', rd_id=d.id) }}">
                  {{ csrf_token() if csrf_token is defined }}
                  <button class="btn sm ghost" title="Oznaƒçi≈• ako vybaven√©">Zavrie≈•</button>
                </form>
              {% endif %}
            </header>

            <div class="rd-body">{{ d.text }}</div>

            <footer class="rd-actions">
              {% if current_user.is_authenticated %}
                <a class="btn" href="{{ url_for('spravy.napisat', kontekst='dopyt', kontekst_id=d.id, komu_id=d.autor_id) }}">
                  Odpoveda≈• spr√°vou
                </a>
              {% else %}
                <button class="btn" data-modal-open="#modal-login">Odpoveda≈• spr√°vou</button>
              {% endif %}
              <span class="meta exp">Plat√≠ do: {{ d.plati_do|localtime('%d.%m.%Y') if d.plati_do else '‚Äî' }}</span>
            </footer>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <article class="card" style="padding:1rem;">
        <p class="meta" style="margin:0;color:#666;">Zatiaƒæ ≈æiadne dopyty. Nap√≠≈° prv√Ω v mini-formul√°ri hore.</p>
      </article>
    {% endif %}
  </aside>
</div>

<style>
  .rd-layout{ display:grid; grid-template-columns:minmax(280px,36%) 1fr; gap:1.25rem; }
  .filterbar .filter-row{ display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
  .filterbar .mine-row{ border-top:1px dashed #e5e7eb; margin-top:.5rem; padding-top:.5rem; }
  .chip-btn{
    display:inline-flex; align-items:center; height:34px; padding:0 .75rem;
    border:1px solid #e5e7eb; border-radius:8px; background:#fff; text-decoration:none;
    font-weight:500; color:#111; transition:background .15s, border-color .15s, color .15s;
  }
  .chip-btn:hover{ background:#f9fafb; border-color:#cbd5e1; }
  .chip-btn.active{ background:#111; color:#fff; border-color:#111; }

  .rd-list{ display:grid; gap:.75rem; }
  .rd-card{ padding:1rem; }
  .rd-head{ display:flex; gap:.75rem; align-items:center; justify-content:space-between; margin-bottom:.4rem; }
  .rd-body{ white-space:pre-wrap; margin:.25rem 0 .5rem 0; }
  .rd-actions{ display:flex; align-items:center; gap:.5rem; justify-content:space-between; }
  .rd-actions .exp{ color:#666; }
  @media (max-width: 900px){ .rd-layout{ grid-template-columns:1fr; } }
</style>
