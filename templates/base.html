<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}muzikuj{% endblock %}</title>
  <script>
  (function () {
    try {
      var userTheme = {{ (current_user.theme if current_user.is_authenticated else None)|tojson }};
      var m = document.cookie.match(/(?:^|; )mz_prefs=([^;]+)/);
      var cookieTheme = null;
      if (m) { try { cookieTheme = JSON.parse(decodeURIComponent(m[1])).theme; } catch(_) {} }

      var theme = cookieTheme || (userTheme && userTheme !== 'system' ? userTheme : null);

      if (theme && theme !== 'system') {
        document.documentElement.setAttribute('data-theme', theme);
      } else {
        document.documentElement.removeAttribute('data-theme'); // => hned√Ω default
      }
    } catch (_) {}
  })();
  </script>

  <!-- Fonts -->
  
 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">


  <!-- 1) Tokens & Base -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/tokens.css', v=3) }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">

  <!-- 2) Layout -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout/header.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout/sidebar.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout/footer.css') }}">
  
  <!-- 3) Components -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/button.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/modal.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/alert.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/role-badge.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/header-icons.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/mini-list.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/filterbar.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/grids.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/card.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/novinky.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/notice.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/formbox.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/utils.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/components/icons.css') }}">

  <!-- 4) Forms -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}">

  <!-- 5) Pages -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/home.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/kontakt.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/podujatie.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/reklama.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/registracia.css') }}">

  <!-- 6) ≈†pecifick√© sekcie -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/profil.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/skupina.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/kalendar.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/inzerat.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/komunita.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/spravy.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dopyty.css') }}">

</head>

<body data-zobraz="{{ zobraz_formular }}">

<header class="hlavicka">
  <!-- RIADOK 1: box1 | box2 -->
  <div class="hlavicka-top-row">
    <div class="box1">
      <div class="logo">muziku‚ô™.sk</div>
    </div>

    <div class="box2">
      <div class="box2-wrapper">
        <div class="social-icons">
          <a href="#"><img src="{{ url_for('static', filename='fb.png') }}" alt="Facebook"></a>
          <a href="#"><img src="{{ url_for('static', filename='ig.png') }}" alt="Instagram"></a>
        </div>

        <div class="user-panel">
          {% if current_user.is_authenticated %}
            <a href="{{ url_for('spravy.inbox') }}"
               class="msg-icon {{ 'has-unread' if neprecitane_count and neprecitane_count > 0 else '' }}"
               aria-label="Spr√°vy" title="Spr√°vy">
              <span class="icon">‚úâÔ∏è</span>
              {% if neprecitane_count and neprecitane_count > 0 %}
                <span class="badge">{{ neprecitane_count }}</span>
              {% endif %}
            </a>

            {% set has_unread = (neprecitane_forum_count|default(0)|int) > 0 %}
            <a href="{{ url_for('forum.goto_unread') if has_unread else url_for('komunita.hub', tab='forum') + '#tab-forum' }}"
               class="msg-icon {{ 'has-unread' if has_unread else '' }}"
               aria-label="F√≥rum" title="F√≥rum">
              <span class="icon">üí¨</span>
              {% if has_unread %}
                <span class="badge">{{ neprecitane_forum_count|default(0)|int }}</span>
              {% endif %}
            </a>

            <span class="user-info">
              üëã {{ current_user.prezyvka }}
              {% if current_user.is_admin %}
                <span class="role-badge admin" title="Admin">Admin</span>
              {% elif current_user.is_moderator %}
                <span class="role-badge mod" title="Moder√°tor">Mod</span>
              {% endif %}
            </span>

            {% if current_user.is_admin or current_user.is_moderator %}
              <a href="{{ url_for('moderacia.dashboard' if current_user.is_admin else 'moderacia.queue') }}" class="header-btn">
                üõ°Ô∏è {{ 'Admin' if current_user.is_admin else 'Moder√°cia' }}
              </a>
            {% endif %}

            <a href="{{ url_for('uzivatel.profil') }}" class="header-btn">Moje konto</a>
            <a href="{{ url_for('uzivatel.logout') }}" class="header-btn logout-btn">Odhl√°si≈• sa</a>
          {% else %}
            <a href="{{ url_for('uzivatel.login') }}" class="header-btn" data-modal-open="#modal-login">Prihl√°si≈• sa</a>
            <a href="{{ url_for('uzivatel.registracia') }}" class="header-btn" data-modal-open="#user-form-panel">Registrova≈• sa</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- RIADOK 2: NAV (1fr | 1200 | 1fr) -->
<div class="hlavicka-nav-row">
  <div class="nav-cell">

    <!-- ƒΩAV√Å Z√ìNA: Moje menu -->
    <div class="nav-left">
      {% if current_user.is_authenticated %}
        <button class="menu-btn on-dark" id="menu-toggle" type="button" aria-controls="user-menu" aria-expanded="false">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-menu"></use></svg>
          Moje menu
        </button>
      {% endif %}
    </div>


    <!-- STRED: hlavn√° navig√°cia (bez zmeny) -->
    <nav class="main-nav">
      <a class="with-icon on-dark" href="{{ url_for('uzivatel.index') }}">
        <svg class="icon icon--md" aria-hidden="true"><use href="#i-home"></use></svg>
        Domov
      </a>

      <!-- NOV√â: Podujatia (verejn√©) -->
      <a class="with-icon on-dark" href="{{ url_for('podujatie.index') }}">
        <svg class="icon icon--md" aria-hidden="true"><use href="#i-podujatia"></use></svg>
        Podujatia
      </a>

      {% if current_user.is_authenticated %}
        <a class="with-icon on-dark" href="{{ url_for('dopyty.zobraz_dopyty') }}">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-dopyty"></use></svg>
          Dopyty
        </a>

        {% if current_user.typ_subjektu != 'ico' %}
          <a class="with-icon on-dark" href="{{ url_for('skupina.prehlad_skupin') }}">
            <svg class="icon icon--md" aria-hidden="true"><use href="#i-skupiny"></use></svg>
            Skupiny
          </a>
          <a class="with-icon on-dark" href="{{ url_for('inzerat.bazar_verejny') }}">
            <svg class="icon icon--md" aria-hidden="true"><use href="#i-bazar"></use></svg>
            Baz√°r
          </a>
          <a class="with-icon on-dark" href="{{ url_for('komunita.hub') }}">
            <svg class="icon icon--md" aria-hidden="true"><use href="#i-komunita"></use></svg>
            Komunita
          </a>
        {% endif %}

        <a class="with-icon on-dark" href="#kontakt">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-kontakt"></use></svg>
          Kontakt
        </a>

      {% else %}
        <a class="with-icon on-dark disabled-link" href="#" data-modal-open="#modal-login">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-dopyty"></use></svg>
          Dopyty
        </a>
        <a class="with-icon on-dark disabled-link" href="#" data-modal-open="#modal-login">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-skupiny"></use></svg>
          Skupiny
        </a>
        <a class="with-icon on-dark disabled-link" href="#" data-modal-open="#modal-login">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-bazar"></use></svg>
          Baz√°r
        </a>
        <a class="with-icon on-dark disabled-link" href="#" data-modal-open="#modal-login">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-komunita"></use></svg>
          Komunita
        </a>
        <a class="with-icon on-dark" href="#kontakt">
          <svg class="icon icon--md" aria-hidden="true"><use href="#i-kontakt"></use></svg>
          Kontakt
        </a>
      {% endif %}
    </nav>


    <!-- PRAV√Å Z√ìNA: (rezerva, nech√°vam pr√°zdne) -->
    <div class="nav-right"></div>

  </div>
</div>


  <!-- RIADOK 3: 1fr | ƒΩAV√ù FILTER | STREDN√ù | PRAV√ù | 1fr (spolu 1200px) -->
  <div class="hlavicka-strip-row">
    <div aria-hidden="true"></div>

    {% if request.endpoint == 'uzivatel.index' %}
      <!-- ƒΩAV√ù FILTER (napr. vide√°) -->
      <div class="filter-box">
        <button class="chip sm is-active" data-video="all">V≈°etko</button>
        <button class="chip sm" data-video="folklor">Folkl√≥r</button>
        <button class="chip sm" data-video="rock">Hip hop</button>
        <button class="chip sm" data-video="rock">Rock</button>
        <label class="chip-select">
          <select id="genreVideoSelect" aria-label="≈Ω√°ner vide√≠">
            <option value="all">-V√Ωber-</option>
            <option value="rock">Rock</option>
            <option value="folklor">Folkl√≥r</option>
            <option value="hiphop">Hip hop</option>
            <option value="jazz">Jazz</option>
            <option value="pop">Pop</option>
          </select>
        </label>
      </div>

      <!-- STREDN√ù FILTER (regi√≥ny) -->
      <div class="filter-box">
        <button class="chip is-active" data-region="all">Cel√© SK</button>
        <button class="chip" data-region="zapad">Z√°pad</button>
        <button class="chip" data-region="stred">Stred</button>
        <button class="chip" data-region="vychod">V√Ωchod</button>
      </div>

      <!-- PRAV√ù FILTER (napr. blogy/s√∫≈•a≈æe) -->
      <div class="filter-box">
        <button class="chip sm is-active" data-blog="all">V≈°etko</button>
        <button class="chip sm" data-blog="folklor">Folkl√≥r</button>
        <button class="chip sm" data-video="rock">Hip hop</button>
        <button class="chip sm" data-blog="rock">Rock</button>
        <label class="chip-select">
          <select id="genreBlogSelect" aria-label="≈Ω√°ner blogov">
            <option value="all">-V√Ωber-</option>
            <option value="rock">Rock</option>
            <option value="folklor">Folkl√≥r</option>
            <option value="hiphop">Hip hop</option>
            <option value="jazz">Jazz</option>
            <option value="pop">Pop</option>
          </select>
        </label>
      </div>
    {% else %}
      <!-- MIMO HOMEPAGE: uprostred info panel, kraje pr√°zdne -->
      <div></div>
      <div class="filter-box banner-info">
        <strong class="page-title">
          {% block page_title %}
            {{ (page_title or request.blueprint or request.endpoint) | replace('_',' ') | title }}
          {% endblock %}

        </strong>
        {% if page_sub %}<span class="page-sub">{{ page_sub }}</span>{% endif %}
      </div>
      <div></div>
    {% endif %}

    <div aria-hidden="true"></div>
  </div>
</header>
<!-- OFFCANVAS PANEL: Moje menu -->
<aside id="user-menu" class="offcanvas" aria-hidden="true">
  <div class="offcanvas-head">
    <strong>Moje menu</strong>
    <button type="button" class="offcanvas-close" aria-label="Zavrie≈•">√ó</button>
  </div>

  <div class="offcanvas-body">
    {% include 'includes/sidebox.html' %}
  </div>
</aside>


<script>
  function toggleMenu(){
    const nav = document.querySelector('.hlavicka .main-nav');
    if(nav) nav.classList.toggle('open');
  }
</script>



 {# =======================
          HOMEPAGE 
    ======================= #}
{% if request.endpoint == 'uzivatel.index' %}

  <!-- üîπ GRID celej str√°nky (posunut√Ω pod fixed header+banner) -->
  <div class="page-grid body-offset">
    <div class="page-left">
      <!--<aside class="button-sidebar">
        {% include 'includes/sidebox.html' %}
      </aside>-->
    </div>

    <main class="page-center">
      <div class="home-shell">
        <div class="home-grid">
          <aside class="home-left">
            {% block home_left %}{% endblock %}
          </aside>

          <section class="home-center" id="home-feed">

            <!-- MOBIL/TABLET: prep√≠naƒç sekci√≠ -->

            <div class="m-tabs" role="tablist" aria-label="Sekcie">
              <button class="m-tab is-active" data-tab="videa"  role="tab" aria-selected="true">Videa</button>
              <button class="m-tab"          data-tab="pod"    role="tab" aria-selected="false">Podujatia</button>
              <button class="m-tab"          data-tab="blogy"  role="tab" aria-selected="false">Blogy</button>
            </div>

            <!-- MOBIL/TABLET: panely -->
             {% if current_user.is_admin %}
                <div class="note" style="margin:10px 0;padding:8px 10px;border:1px dashed #ccc;border-radius:8px;font-size:.9rem;opacity:.75;">
                  Filtre s√∫ doƒçasne vypnut√© ‚Äì najprv doprogramujeme publikovanie vide√≠/podujat√≠/blogov.
                </div>
              {% endif %}

            <div class="m-panels">
              <section class="m-panel is-active" data-panel="videa" role="tabpanel">
                <div class="m-filter">{% include 'includes/filter_videa.html'  ignore missing %}</div>
                <div class="m-feed" id="m-feed-videa"><!-- karty vide√≠ --></div>
              </section>

              <section class="m-panel" data-panel="pod" role="tabpanel" aria-hidden="true">
                <div class="m-filter">{% include 'includes/filter_regiony.html' ignore missing%}</div>
                <div class="m-feed" id="m-feed-pod"><!-- zoznam podujat√≠ --></div>
              </section>

              <section class="m-panel" data-panel="blogy" role="tabpanel" aria-hidden="true">
                <div class="m-filter">{% include 'includes/filter_blogy.html' ignore missing%}</div>
                <div class="m-feed" id="m-feed-blogy"><!-- karty blogov --></div>
              </section>
            </div>

            {% block home_content %}{% endblock %}
          </section>

          <aside class="home-right">
            {% block home_right %}{% endblock %}
          </aside>
        </div>
      </div>
    </main>

    <div class="page-right" aria-hidden="true"></div>
  </div>

{% else %}

  <!-- üîπ Layout bez home-gridu (tie≈æ posunut√Ω) -->
  <div class="button-container body-offset">
    {% if current_user.is_authenticated %}
      <!--<aside class="button-sidebar">
        {% include 'includes/sidebox.html' %}
      </aside>-->
    {% endif %}
    <main class="{{ 'main-content' if current_user.is_authenticated else 'main-no-sidebar' }}">
      {% block content %}{% endblock %}
    </main>
  </div>
{% endif %}

{% include 'includes/novinky.html' %}
{% include 'partials/flash.html' %}

{% if zobraz_uvitanie %}
  <div id="uvitanie-popup" class="uvitanie-box">
    <h2>üéâ Vitaj v komunite hudobn√≠kov, {{ zobraz_uvitanie }}!</h2>
    <p>Tvoj √∫ƒçet bol √∫spe≈°ne vytvoren√Ω.</p>
  </div>
{% endif %}

<!-- MOD√ÅLY -->
{% include 'modals/prihlasenie.html' %}
{% include 'modals/registracia.html' %}
{% include 'includes/cookie_banner.html' %}
{% include "modals/dopyt_form.html" %}
{% include "includes/icons.html" %}
<script src="{{ url_for('static', filename='js/cookies.js') }}" defer></script>


<!-- Extra modal pre spr√°vy (unifikovan√© triedy, BEZ inline ≈°t√Ωlov) -->
<div id="sprava-modal" class="modal-root" hidden aria-hidden="true" role="dialog" aria-labelledby="sprava-title">
  <div class="modal-backdrop" data-modal-close></div>
  <div class="modal-card">
    <form id="sprava-form" method="POST" action="#">
      <h3 id="sprava-title">Nap√≠sa≈• reakciu</h3>
      <input type="hidden" name="dopyt_id">
      <div class="form-fields">
        <label>Komu <input type="email" name="to" placeholder="prij√≠mateƒæ" required></label>
        <label>Predmet <input type="text" name="subject" required></label>
        <label>Spr√°va <textarea name="message" rows="6" placeholder="Tvoja ponuka, dostupnos≈•, cena‚Ä¶" required></textarea></label>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn" data-modal-close>Zavrie≈•</button>
        <button type="submit" class="btn primary">Odosla≈•</button>
      </div>
    </form>
  </div>
</div>

<section id="kontakt" class="kontakt">
  <h2>Kontaktujte n√°s</h2>
  <div class="kontakt-boxy">
    <div class="kontakt-box"><h3>Email</h3><p><a href="mailto:info@muzikuj.sk">info@muzikuj.sk</a></p></div>
    <div class="kontakt-box"><h3>Soci√°lne siete</h3><p><a href="#">Facebook</a> | <a href="#">Instagram</a></p></div>
  </div>
</section>

<div id="imgLightbox" class="img-lightbox" hidden aria-hidden="true" role="dialog">
  <span class="close" aria-label="Zavrie≈•">√ó</span>
  <img alt="">
</div>

<footer><p>&copy; 2025 muzikuj.sk | V≈°etky pr√°va vyhraden√©</p>
  <a href="#" onclick="openCookieSettings();return false;">Nastavenia s√∫kromia</a>
</footer>

<!-- Dedup mod√°lov (ak by sa niekde vlo≈æili 2x) -->
<script>
  (function () {
    ['modal-login', 'user-form-panel', 'dopyt-form', 'form-inzerat'].forEach(id => {
      const all = document.querySelectorAll('#' + id);
      if (all.length > 1) {
        all.forEach((el, i) => { if (i < all.length - 1) el.remove(); });
        console.warn('‚ö†Ô∏è Removed duplicate modal:', id, 'had', all.length, 'copies');
      }
    });
  })();
</script>

<!-- Spr√°vca mod√°lov + fallback na URL (bez dopisovania ≈°t√Ωlov) -->
<script>
  (function () {
    if (window.__PORTAL_MODAL_MGR__) return; window.__PORTAL_MODAL_MGR__ = true;
    const $  = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => [...r.querySelectorAll(s)];
    let lastOpener = null;

    function openModal(selOrEl) {
      const isSelector = typeof selOrEl === 'string';
      const m = isSelector ? $(selOrEl) : selOrEl;

      if (!m) {
        const sel = isSelector ? selOrEl : '';
        if (sel === '#modal-login') {
          window.location.href = "{{ url_for('uzivatel.login') }}";
        } else if (sel === '#user-form-panel') {
          window.location.href = "{{ url_for('uzivatel.registracia') }}";
        } else if (sel === '#dopyt-form') {
          window.location.href = "{{ url_for('uzivatel.index') }}#dopyt-form";
        }
        return;
      }

      m.hidden = false;
      m.setAttribute('aria-hidden','false');
      m.classList.add('open');
      document.body.classList.add('modal-open');

      const first = m.querySelector('[autofocus], input, select, textarea, button, [href], [tabindex]:not([tabindex="-1"])');
      if (first) first.focus({preventScroll:true});
    }

    function closeModal(node) {
      const m = node?.closest?.('.modal-root, .modal') || node; if (!m) return;
      if (m.contains(document.activeElement)) document.activeElement.blur();
      m.classList.remove('open');
      m.hidden = true;
      m.setAttribute('aria-hidden','true');

      if (!document.querySelector('.modal-root.open, .modal.open')) {
        document.body.classList.remove('modal-open');
      }
      if (lastOpener && document.body.contains(lastOpener)) lastOpener.focus({preventScroll:true});
    }

    document.addEventListener('click', (e) => {
      const opener = e.target.closest('[data-modal-open]');
      if (opener){
        e.preventDefault();
        lastOpener = opener;
        openModal(opener.getAttribute('data-modal-open'));
        return;
      }
      const closer = e.target.closest('[data-modal-close], .modal-close');
      if (closer){ e.preventDefault(); closeModal(closer); return; }
      if (e.target.classList?.contains('modal-backdrop')) { e.preventDefault(); closeModal(e.target); }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') $$('.modal-root.open, .modal.open').forEach(m => closeModal(m));
    });

    window.openModal = openModal; window.closeModal = closeModal;
  })();
</script>

<!-- Auto-otvorenie dopytu pri pr√≠chode s #dopyt-form -->
<script>
  document.addEventListener('DOMContentLoaded', function(){
    if (location.hash === '#dopyt-form' && document.querySelector('#dopyt-form')) {
      if (typeof window.openModal === 'function') window.openModal('#dopyt-form');
    }
  });
</script>

<script>
(function(){
  const lb = document.getElementById('imgLightbox');
  if (!lb) return;

  const imgEl = lb.querySelector('img');

  function open(src, alt){
    imgEl.src = src;
    imgEl.alt = alt || '';
    lb.hidden = false;
    lb.classList.add('open');
    lb.setAttribute('aria-hidden','false');
  }
  function close(){
    lb.classList.remove('open');
    lb.hidden = true;
    lb.setAttribute('aria-hidden','true');
    imgEl.src = '';
  }

  // Delegovan√Ω klik: funguje pre [data-lightbox] aj .feed-card .cover
  document.addEventListener('click', (e) => {
    const trigger = e.target.closest('[data-lightbox], .feed-card .cover');
    if (trigger){
      e.preventDefault();
      const src = trigger.getAttribute && trigger.getAttribute('data-full')
                 ? trigger.getAttribute('data-full')
                 : (trigger.currentSrc || trigger.src);
      const alt = (trigger.getAttribute && trigger.getAttribute('alt')) || '';
      open(src, alt);
      return;
    }
    if (e.target === lb || e.target.closest('.close')) close();
  });

  // ESC zavrie lightbox
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && lb.classList.contains('open')) close();
  });
})();
</script>
<script>
  function setActive(groupSel, btn){
    document.querySelectorAll(groupSel + ' .chip').forEach(b=>b.classList.remove('is-active'));
    btn.classList.add('is-active');
  }

  document.querySelectorAll('.filter-left .chip').forEach(b=>{
    b.addEventListener('click', e=>{
      setActive('.filter-left', e.currentTarget);
      const g = e.currentTarget.dataset.video; // TODO: naƒç√≠taj vide√°
    });
  });

  document.querySelectorAll('.filter-center .chip').forEach(b=>{
    b.addEventListener('click', e=>{
      setActive('.filter-center', e.currentTarget);
      const r = e.currentTarget.dataset.region; // TODO: naƒç√≠taj podujatia
    });
  });

  document.querySelectorAll('.filter-right .chip').forEach(b=>{
    b.addEventListener('click', e=>{
      setActive('.filter-right', e.currentTarget);
      const t = e.currentTarget.dataset.blog; // TODO: naƒç√≠taj blogy/s√∫≈•a≈æe
    });
  });
</script>
<script>
  // VIDEO ƒæav√Ω select
  const genreVideoSel = document.getElementById('genreVideoSelect');
  if (genreVideoSel) {
    genreVideoSel.addEventListener('change', (e) => {
      const genre = e.target.value; // all|rock|folklor|hiphop|...
      // TODO: fetchLeftVideos(genre);
    });
  }

  // BLOG prav√Ω select
  const genreBlogSel = document.getElementById('genreBlogSelect');
  if (genreBlogSel) {
    genreBlogSel.addEventListener('change', (e) => {
      const genre = e.target.value;
      // TODO: fetchRightBlogs(genre);
    });
  }
</script>
<script>
(function(){
  const $ = s => document.querySelector(s);
  const header = $('.hlavicka');
  const banner = $('.site-banner');
  if(!header || !banner) return;

  function updateHeights(){
    // reflow, k√Ωm s√∫ fixed
    const h1 = header.getBoundingClientRect().height || 0;
    // banner m√¥≈æe meni≈• v√Ω≈°ku podƒæa obsahu/riadku filtra
    const h2 = banner.getBoundingClientRect().height || 0;

    // posu≈à banner hneƒè pod header
    document.documentElement.style.setProperty('--header-top-h', h1 + 'px');
    // s√∫ƒçet pre odsadenie obsahu a sticky prvkov
    document.documentElement.style.setProperty('--chrome-h', (h1 + h2) + 'px');
  }

  // keƒè sa ƒçokoƒævek zmen√≠ (resize, fonty, breakpointy‚Ä¶)
  const ro = new ResizeObserver(updateHeights);
  ro.observe(header);
  ro.observe(banner);
  window.addEventListener('load', updateHeights);
  window.addEventListener('resize', updateHeights);
  updateHeights();
})();
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const tabs   = document.querySelectorAll('.m-tab');
  const panels = document.querySelectorAll('.m-panel');
  if (!tabs.length) return;

  function activate(name){
    tabs.forEach(t => {
      const on = t.dataset.tab === name;
      t.classList.toggle('is-active', on);
      t.setAttribute('aria-selected', on ? 'true' : 'false');
    });
    panels.forEach(p => {
      const on = p.dataset.panel === name;
      p.classList.toggle('is-active', on);
      p.setAttribute('aria-hidden', on ? 'false' : 'true');
    });
  }

  tabs.forEach(t => t.addEventListener('click', () => activate(t.dataset.tab)));

  // voliteƒæne: default sekciu podƒæa hash #pod/#blogy/#videa
  const hash = location.hash.replace('#','');
  if (hash && ['videa','pod','blogy'].includes(hash)) activate(hash);
});
</script>

<script type="text/plain" data-cat="analytics" src="https://plausible.io/js/plausible.js" data-domain="muzikuj.sk" defer></script>

<!-- Projektov√© skripty -->
<script src="{{ url_for('static', filename='main.js') }}" defer></script>
{% if show_tpl_badge and current_user.is_authenticated and (current_user.is_admin or current_user.is_moderator) %}
<div style="position:fixed;left:8px;bottom:8px;z-index:9999;background:#111;color:#0f0;font:12px/1.2 monospace;padding:4px 6px;border-radius:4px;opacity:.85;">
  TPL: {{ g._last_template or 'nezn√°me' }} ‚Ä¢ EP: {{ request.endpoint or '‚Äî' }}
</div>
{% endif %}

</body>
</html>
